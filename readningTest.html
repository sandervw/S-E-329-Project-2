<html>
 <head>
  <script type="application/javascript">
var intervalId;
var ID_GLOBAL = 0;
var rooms = {}; //We're just going to use a map

var amount = 5; //Default value
var lastend = Math.PI * 3/2;

this.init = function init(){
  clock();

  intervalId = setInterval(clock, 1000);
}

//Display text should appear on a button
var nxttile = function(nextname, displaytext)
{
this.nextname = nextname;
this.displaytext = displaytext;
}

//A tile has a scenario text and an array of nxttiles
//It will make a button for each option
//It also has an id
var tile = function(name, scenariotext, options, time)
{
	this.name = name
	this.scenariotext = scenariotext
	this.options = options; 
	this.time = time;
	rooms[name] = this;//Add to global map
}

var loadTile = function(name)
{
	context.clearRect(0, 0, canvas.width, canvas.height);
	var tile = rooms[name];//tiles[id];
	var qid = document.getElementById('question');
	var cid = document.getElementById("choices");
	cid.innerHTML = "";
	qid.innerHTML = tile.scenariotext;
	
	//reset
	amount = tile.time;
	//lastend = Math.PI * 3/2;
	start = new Date().getTime();
	expired = false;
	
	for(i = 0; i < tile.options.length; i++)
	{
		var btn = document.createElement("BUTTON"); 
		btn.next = tile.options[i].nextname;
		btn.onclick = function(){
			loadTile(this.next);
			};
		
		cid.appendChild(btn);
	}
}

var start;
var expired = false;

//Called every second
function clock(){
  // no notification when we get unloaded/replaced, so check here
  var canvas = document.getElementById('canvas');
  if (!canvas) {
    clearInterval(intervalId);
    return;
  }

	var time = Math.round((new Date().getTime() - start)/1000)      
	lastend = Math.PI * 3/2;
	var context = canvas.getContext('2d');
	
	var centerX = canvas.width / 2;
	var centerY = canvas.height / 2;
	var radius = 70;
	//amount = 5;

	context.beginPath();
	context.arc(centerX, centerY, radius, 0 * Math.PI, 2 * Math.PI, false);
	context.fillStyle = 'red';
	context.lineWidth = 5;
	context.strokeStyle = '#003300';
	context.stroke();
  
	context.beginPath();
	context.moveTo(canvas.width / 2, canvas.height / 2);
	context.arc(canvas.width / 2, canvas.height / 2, canvas.height / 2, lastend, lastend + (Math.PI * 2 * (time / amount)), false);
	context.lineTo(canvas.width / 2, canvas.height / 2);

	context.fill();

	lastend += (Math.PI * 2 * (time / amount)) % Math.PI;
	 if (time > amount && !expired)//Only trigger expire once. You ran out of time, yo.
	{
		expired = true;
	}
}
  </script>
 </head>
 <body>
   <canvas id="canvas" width="150" height="150"></canvas>
   <div><br><br></div>
   <center> 
		<div id="question">Question</div>
		<div id="choices"></div>
   </center>
 </body>
 <script>  start = new Date().getTime();</script>
 <script>this.init();
 var canvas = document.getElementById('canvas');
var context = canvas.getContext('2d');
 
 var tmp = new nxttile("first_room", "go to one");
 var nxts = [tmp];
var t = new tile("start_room", "this is a test", nxts, 10);
new tile("first_room", "This is number one", [5,3], 20);
loadTile(t.name);

 
 
 
 </script>
</html>