<html>
 <head>
  <script type="application/javascript">
var intervalId;
var ID_GLOBAL = 0;
var tiles = [];

this.init = function init(){
  clock();

  intervalId = setInterval(clock, 1000);
}

//An option has an id for next tile
//And text / replcement
var option = function(text, ids){
	this.text = text;//TODO make translate function that parses for difficulty level
	this.ids = ids;//An array of tiles that each button goes to.
	//Actually array is an array of nxttiles containing nextid and displaytext
}

var nxttile = function(nextid, displaytext)
{
this.nextid = nextid;
this.displaytext = displaytext;
}

//A tile has a scenario text and an array of nxttiles
//It will make a button for each option
//It also has an id
var tile = function(scenariotext, options)
{
	this.id = ID_GLOBAL++;
	this.scenariotext = scenariotext
	this.options = options; //This assumes things are pushed in the order of order. A key,value pair would be better
	tiles.push(this);//Add to global array
}

var loadTile = function(id)
{
	console.log("Id: " + id);
	console.log(tiles);
	console.log(tiles[id]);
	
	var tile = tiles[id];
	var qid = document.getElementById('question');
	var cid = document.getElementById("choices");
	cid.innerHTML = "";
	qid.innerHTML = tile.scenariotext;
	console.log("length: " + tile.options.length);
	for(i = 0; i < tile.options.length; i++)
	{
		var btn = document.createElement("BUTTON"); 
		btn.next = tile.options[i].nextid;
		btn.onclick = function(){
			console.log()
			//Here be errors--when we actually click it, tile.options is meaningless
			console.log("clicked: " +  this.next);
			loadTile(this.next);
			};
		
		
		
		cid.appendChild(btn);
		
	}
}

var start;
var reported = false;




function clock(){


  // no notification when we get unloaded/replaced, so check here
  var canvas = document.getElementById('canvas');
  if (!canvas) {
    clearInterval(intervalId);
    return;
  }

	var time = Math.round((new Date().getTime() - start)/1000)      
	var lastend = Math.PI * 3/2;
	var context = canvas.getContext('2d');
	
	var centerX = canvas.width / 2;
	var centerY = canvas.height / 2;
	var radius = 70;
	var amount = 5;

	context.beginPath();
	context.arc(centerX, centerY, radius, 0 * Math.PI, 2 * Math.PI, false);
	context.fillStyle = 'red';
	//context.fill();
	context.lineWidth = 5;
	context.strokeStyle = '#003300';
	context.stroke();
  
	context.beginPath();
	context.moveTo(canvas.width / 2, canvas.height / 2);
	context.arc(canvas.width / 2, canvas.height / 2, canvas.height / 2, lastend, lastend + (Math.PI * 2 * (time / amount)), false);
	context.lineTo(canvas.width / 2, canvas.height / 2);

	context.fill();

	lastend += (Math.PI * 2 * (time / amount)) % Math.PI;
	 if (time > amount && !reported)
	{
		//alert("expired");
		reported = true;
	}

}
  </script>
 </head>
 <body>
   <canvas id="canvas" width="150" height="150"></canvas>
   <div><br><br></div>
   <center> 
		<div id="question">Question</div>
		<div id="choices"></div>
   </center>
 </body>
 <script>  start = new Date().getTime();</script>
 <script>this.init();
 var tmp = new nxttile(1, "go to one");
 var nxts = [tmp];
var t = new tile("this is a test", nxts);
new tile("This is number one", [5,3]);
loadTile(t.id);

 
 
 
 </script>
</html>